# 字幕脚本日志说明

## 日志功能

我已经为 sub-assrt.lua 和 uosc 的字幕功能添加了详细的日志记录。这些日志可以帮助您：

1. **调试字幕功能问题**
2. **了解脚本执行流程**
3. **监控字幕下载过程**
4. **排查网络连接问题**

## 日志内容

### ASSRT 字幕脚本日志

#### 主要功能日志：
- `[ASSRT] ========== 开始 ASSRT 字幕搜索 ==========` - 脚本启动
- `[ASSRT] 当前视频路径: xxx` - 当前播放的视频路径
- `[ASSRT] 格式化后的搜索查询: xxx` - 处理后的搜索关键词
- `[ASSRT] 使用缓存的搜索结果` - 使用了缓存的搜索结果
- `[ASSRT] 缓存未命中，开始新的搜索` - 开始新的搜索

#### 搜索过程日志：
- `[ASSRT] 开始搜索字幕，查询: xxx，位置: xxx` - 开始搜索
- `[ASSRT] 搜索URL: xxx` - 实际的搜索API请求地址
- `[ASSRT] 搜索完成，找到 x 个字幕结果` - 搜索结果数量
- `[ASSRT] 未找到任何字幕结果` - 没有找到字幕

#### 下载过程日志：
- `[ASSRT] 开始下载字幕文件: xxx` - 开始下载特定字幕文件
- `[ASSRT] 下载链接: xxx` - 字幕文件的下载链接
- `[ASSRT] 本地视频，字幕保存到: xxx` - 本地视频字幕保存路径
- `[ASSRT] 网络视频，字幕保存到临时目录: xxx` - 网络视频字幕保存路径
- `[ASSRT] 执行下载命令: xxx` - 实际执行的curl命令
- `[ASSRT] 字幕文件下载成功，正在载入: xxx` - 下载成功
- `[ASSRT] 字幕载入完成: xxx` - 字幕载入完成

#### 错误日志：
- `[ASSRT] 未加载任何文件` - 没有加载视频文件
- `[ASSRT] 搜索字幕失败: xxx` - 搜索API请求失败
- `[ASSRT] 字幕文件下载失败，文件不存在: xxx` - 下载失败
- `[ASSRT] 字幕下载失败，curl 错误: xxx` - 网络下载错误

#### 消息处理日志：
- `[ASSRT] 接收到xxx消息` - 各种脚本消息的接收日志
- `[ASSRT] 检测到 uosc 可用` - 检测到uosc界面可用

### uosc 字幕功能日志

#### 菜单操作日志：
- `[uosc] 调用 OpenSubtitles 字幕下载: xxx` - 调用OpenSubtitles功能
- `[uosc] 调用 ASSRT 字幕搜索: xxx` - 调用ASSRT搜索功能
- `[uosc] 调用字幕加载: xxx` - 调用字幕文件加载功能

#### OpenSubtitles 功能日志：
- `[uosc] 开始 OpenSubtitles 字幕下载功能` - 开始使用OpenSubtitles
- `[uosc] 字幕下载菜单已打开，关闭中...` - 菜单状态
- `[uosc] 网络视频，搜索建议: xxx` - 网络视频的搜索建议

## 如何查看日志

### 方法1：使用MPV控制台
1. 在MPV播放时按 `backtick` 键（`）打开控制台
2. 日志会实时显示在控制台中
3. 可以使用上下箭头键查看历史日志

### 方法2：使用命令行启动MPV
```bash
# Windows
mpv --msg-level=all=debug 视频文件.mp4

# 或者只显示脚本相关的日志
mpv --msg-level=script=debug 视频文件.mp4
```

### 方法3：启用日志文件
在 `mpv.conf` 中添加：
```
log-file=mpv.log
msg-level=script=debug
```

## 日志级别说明

- `info` - 一般信息，显示正常的操作流程
- `error` - 错误信息，显示失败的操作和错误原因
- `warn` - 警告信息（如果有的话）

## 常见日志分析

### 搜索失败排查
如果看到 `[ASSRT] 搜索字幕失败`，检查：
1. 网络连接是否正常
2. API token 是否正确
3. 代理设置是否正确

### 下载失败排查
如果看到 `[ASSRT] 字幕下载失败`，检查：
1. 下载链接是否有效
2. 文件保存路径是否有写入权限
3. 磁盘空间是否充足

### 功能不工作排查
如果字幕功能完全不工作，检查日志中是否有：
1. `[ASSRT] 检测到 uosc 可用` - 确认uosc集成正常
2. `[ASSRT] 接收到xxx消息` - 确认消息传递正常
3. `[uosc] 调用 xxx` - 确认uosc菜单调用正常

## 注意事项

1. 日志中可能包含API token，请不要在公共场合分享日志内容
2. 日志文件可能会变得很大，建议定期清理
3. 如果不需要详细日志，可以将日志级别设置为 `warn` 或 `error`

## 禁用日志

如果您不需要这些详细日志，可以：
1. 修改脚本，注释掉 `msg.info` 和 `msg.error` 行
2. 或者在 `mpv.conf` 中设置 `msg-level=script=error` 只显示错误日志
