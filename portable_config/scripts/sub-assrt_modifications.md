# sub-assrt.lua 脚本修改总结

## 主要修改内容

### 1. 字幕保存逻辑优化
- **本地视频**：字幕文件保存到视频文件的同一目录下
- **网络视频**：字幕文件保存到临时目录
- 修改了 `download_file()` 函数，使其能够智能判断视频类型并选择合适的保存位置

### 2. 在 uosc 字幕菜单中添加 ASSRT 搜索按钮
- 修改了 `uosc/main.lua` 文件，在字幕菜单配置中添加了 `assrt_command` 选项
- 修改了 `uosc/lib/menus.lua` 文件，在"导入"项目旁边添加了"ASSRT搜索"按钮
- 按钮显示为搜索图标，点击后调用 assrt 字幕搜索功能

### 3. 用户体验改进
- 下载过程中显示不同的提示信息（本地/网络）
- 下载完成后显示字幕保存位置信息
- 完全集成到 uosc 界面中，无需额外的快捷键

### 4. 移除快捷键绑定
- 移除了所有额外的快捷键绑定
- 只保留了脚本消息处理，通过 uosc 菜单调用

## 文件修改列表

1. **sub-assrt.lua** - 主要脚本文件
   - 修改字幕保存逻辑
   - 优化用户提示信息
   - 移除快捷键绑定，只保留脚本消息处理

2. **uosc/main.lua** - uosc 主文件
   - 在字幕菜单配置中添加 `assrt_command` 选项

3. **uosc/lib/menus.lua** - uosc 菜单库文件
   - 修改导入项目的 actions 配置
   - 添加对 assrt 动作的处理

4. **input_scripts.conf** - 快捷键配置文件
   - 移除了快捷键说明（因为不再需要）

5. **sub-assrt_usage.md** - 使用说明文档（新建）
   - 详细的功能介绍和使用方法

## 使用方法

### 在 uosc 字幕菜单中使用
1. 播放视频时，点击 uosc 界面上的字幕按钮（或按 `s` 键）
2. 在字幕菜单中，点击"导入"项目旁边的"ASSRT搜索"按钮
3. 输入搜索关键词，按 Enter 搜索
4. 从搜索结果中选择合适的字幕
5. 查看字幕文件列表，选择需要的字幕文件下载

### 按钮位置
- 在字幕轨道列表的顶部
- "导入"项目的右侧会显示两个按钮：
  - "语言" 图标：uosc 内置的 OpenSubtitles 下载
  - "搜索" 图标：ASSRT 字幕搜索

### 字幕文件保存位置
- **本地视频**: `视频文件目录/视频名.assrt.字幕格式`
- **网络视频**: `%TEMP%/字幕文件名`

### 兼容性
- 完全集成到 uosc 界面中
- 与 uosc 的 OpenSubtitles 功能共存
- 不影响 MPV 原有功能

## 注意事项

1. 需要在 https://assrt.net 注册账号并获取 API 令牌
2. 确保网络连接正常
3. 本地视频需要有写入权限才能保存字幕
4. 修改了 uosc 的核心文件，如果 uosc 更新可能需要重新应用修改

## 测试建议

1. 测试本地视频字幕下载和保存
2. 测试网络视频字幕下载
3. 验证与 uosc OpenSubtitles 功能的共存
4. 检查按钮在字幕菜单中的显示和功能

修改完成后，重启 MPV 即可使用新功能。
